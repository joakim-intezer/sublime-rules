name: "Employee impersonation via Google Group with suspicious indicators"
description: "Public Google Groups can be used to impersonate internal senders, while the reply to address is not under organizational control, leading to fraud, credential phishing, or other unwanted outcomes."
type: "rule"
severity: "high"
source: |
  type.inbound
  and any(headers.reply_to, .display_name in $org_display_names)
  and any(headers.reply_to,
          .email.domain.root_domain != headers.return_path.domain.root_domain
          and .email.domain.root_domain not in $org_domains
  )
  and any(headers.hops,
          .index == 0 and any(.fields, strings.icontains(.value, "googlegroups"))
  )
  and 2 of (
    any(ml.nlu_classifier(body.current_thread.text).entities,
        .name == "financial"
    ),
    any(ml.nlu_classifier(body.current_thread.text).intents,
        .name is not null or .name != "benign"
    ),
    ( // fake thread
      (length(headers.references) == 0 and headers.in_reply_to is null)
      or not any(headers.hops, any(.fields, strings.ilike(.name, "In-Reply-To")))
    )
  )

attack_types:
  - "BEC/Fraud"
  - "Credential Phishing"
  - "Malware/Ransomware"
tactics_and_techniques:
  - "Impersonation: Employee"
  - "Social engineering"
  - "Spoofing"
detection_methods:
  - "Content analysis"
  - "Header analysis"
  - "Natural Language Understanding"
  - "Sender analysis"
id: "f6a45e31-516a-53ca-ba3d-3bc702d1f950"
