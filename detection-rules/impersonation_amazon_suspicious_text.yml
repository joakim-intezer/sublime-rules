name: "Brand impersonation: Amazon with suspicious attachment"
description: |
  Impersonation of Amazon. These are most commonly fake shipping notifications.
  Amazon is the #2 most-impersonated brand (as of Q2 2020)
references:
  - "https://www.pcmag.com/news/google-and-amazon-are-impersonated-the-most-in-phishing-scams"
  - "https://sellercentral.amazon.com/gp/help/external/32261?language=en-US"
type: "rule"
severity: "medium"
source: "type.inbound\nand strings.ilike(sender.display_name, \"amazon*\")\nand any(attachments, .file_type in (\"pdf\", \"jpg\", \"jpeg\", \"png\")\n    and any(ml.logo_detect(.).brands, \n        .name == \"Amazon\" and .confidence in~ (\"medium\", \"high\")\n    )\n    and (\n        any(file.explode(.),\n            any(ml.nlu_classifier(.scan.ocr.raw).intents,\n              .name != \"benign\" and .confidence == \"high\"\n            )\n        )\n        or any(ml.nlu_classifier(coalesce(body.html.display_text, body.plain.raw)).intents,\n            .name != \"benign\" and .confidence == \"high\"\n        )\n    )\n)\n// unsolicited\nand (\n        (\n            sender.email.domain.root_domain in $free_email_providers\n            and sender.email.email not in $recipient_emails\n        )\n        or (\n            sender.email.domain.root_domain not in $free_email_providers\n            and sender.email.domain.domain not in $recipient_domains\n        )\n)\nand sender.email.domain.root_domain not in~ (\n  'amazon.com',\n  'amazon.com.au',\n  'amazon.co.uk',\n  'amazon.de',\n  'amazon.es',\n  'amazon.fr',\n  'amazon.it',\n  'amazon.in',\n  'amazon.lu',\n  'amazon.com.au',\n  'amazonsellerservices.com',\n  'amazon.ae',\n  'amazon.sa',\n  'amazon.cn',\n  'amazon.ca',\n  'amazon.com.mx',\n  'amazon.com.br',\n  'amazon.sg',\n  'amazon.com.tr',\n  'amazonpay.in',\n  'amazonpay.com',\n  'synchronybank.com',\n)\n"
tags:
  - "Brand impersonation"
  - "Suspicious sender"
  - "Suspicious attachment"
testing_pr: 606
testing_sha: 04b49f52e06a77af2d393ccf652ae5c827e7deff
