name: "Brand impersonation: Fake fax"
description: |
  Detects the presence of known brand logos, mentions of "fax" in the subject or sender's display name, and a low reputation link from a first-time sender.
references:
  - "https://www.hoxhunt.com/blog/fax-phishing"
type: "rule"
severity: "medium"
source: "type.inbound\nand 0 < length(body.links) < 5\nand sender.email.domain.root_domain not in $org_domains\nand any(body.links,\n        (\n          .href_url.domain.domain not in $tranco_1m\n          or .href_url.domain.domain in $free_file_hosts\n          or .href_url.domain.root_domain in $free_subdomain_hosts\n          or .href_url.domain.domain in $url_shorteners\n          or \n\n          // mass mailer link, masks the actual URL\n          .href_url.domain.root_domain in (\"hubspotlinks.com\", \"mandrillapp.com\", \"sendgrid.net\", )\n        )\n)\n\n// any brand logo detected\nand (\n  any(attachments,\n      .file_type in $file_types_images and any(ml.logo_detect(.).brands, .name is not null)\n  )\n  or any(ml.logo_detect(beta.message_screenshot()).brands, .name is not null)\n)\n\n// Subject or sender contains fax\nand (strings.icontains(subject.subject, \"fax\") or strings.icontains(sender.display_name, \"fax\"))\n\n// suspicious content\nand (\n  strings.ilike(body.plain.raw, \"*fax*\")\n  or (\n    any(attachments,\n        .file_type in $file_types_images\n        and any(file.explode(.), strings.ilike(.scan.ocr.raw, \"*fax*\"))\n    )\n  )\n)\n\n// first time sender\nand (\n  profile.by_sender().prevalence in (\"new\", \"outlier\")\n  or (\n    profile.by_sender().any_messages_malicious_or_spam\n    and not profile.by_sender().any_false_positives\n  )\n)\n"
attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "Impersonation: Brand"
  - "Image as content"
  - "Free file host"
  - "Free subdomain host"
  - "Social engineering"
detection_methods:
  - "Computer Vision"
  - "Content analysis"
  - "Optical Character Recognition"
  - "Sender analysis"
  - "URL analysis"
id: "2a96b90a-64bf-52ad-b4e4-6f1e8c1dcba6"
testing_pr: 815
testing_sha: aed114f25899ab2d1ff2b5519c78aa177a48fa26
