name: "Attachment: CVE-2021-40444 - MSHTML Remote Code Execution Vulnerability"
description: |
  Attachment contains an external relationship that attempts to load a remote OLE object, consistent with use in CVE-2021-40444.

  On September 7, 2021, Microsoft released details about a zero day RCE vulnerability in MSHTML that affects Microsoft Windows.

  According to Microsoft: "we are aware of targeted attacks that attempt to exploit this vulnerability by using specially-crafted Microsoft Office documents. An attacker could craft a malicious ActiveX control to be used by a Microsoft Office document that hosts the browser rendering engine."
references:
  - "https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-40444"
  - "https://twitter.com/buffaloverflow/status/1436261107329642522"
  - "https://twitter.com/jroosen/status/1435792491899494402"
  - "https://twitter.com/decalage2/status/1436433067619622916"
  - "https://www.reddit.com/r/crowdstrike/comments/pkb9wi/situational_awareness_cve202140444_mshtml_remote/"
  - "https://twitter.com/aaaddress1/status/1436393045939814400"
type: "rule"
severity: "critical"
source: "type.inbound\nand any(attachments,\n        (\n          (\n            .file_extension in~ $file_extensions_macros \n            or .file_extension =~ \"rtf\"\n            or (\n              .file_extension is null\n              and .file_type == \"unknown\"\n              and .content_type == \"application/octet-stream\"\n              and .size < 100000000\n            )\n          )\n          and any(file.oletools(.).relationships, regex.icontains(.target, \".*html:http.*\"))\n        )\n        or (\n          .file_extension in~ $file_extensions_common_archives\n          and any(file.explode(.),\n                  .flavors.mime == \"text/xml\"\n                  and any(.scan.strings.strings, regex.icontains(., \".*oleObject.*mhtml.*http.*\"))\n          )\n        )\n)\n"
tags:
  - "CVE-2021-40444"
attack_types:
  - "Malware/Ransomware"
tactics_and_techniques:
  - "Exploit"
  - "Macros"
  - "Scripting"
detection_methods:
  - "Archive analysis"
  - "Content analysis"
  - "File analysis"
  - "Macro analysis"
  - "OLE analysis"
id: "8cefcf7f-2a48-5102-9b09-8db995759223"
testing_pr: 679
testing_sha: 762894502b2b43e0f80c2f49fe85b09fa3c4c304
