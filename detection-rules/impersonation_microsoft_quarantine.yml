name: "Brand impersonation: Microsoft quarantine release notification"
description: |
  Message contains credential theft language and references to the Microsoft Exchange quarantine, but did not come from Microsoft.
type: "rule"
severity: "high"
source: "type.inbound\nand length(filter(attachments, .file_type not in~ ('png', 'jpeg', 'jpg', 'bmp', 'gif'))) == 0 \nand any(attachments,\n    any(file.explode(.),\n        any(ml.nlu_classifier(.scan.ocr.raw).intents, .name == \"cred_theft\" and .confidence != \"low\")\n        and any(ml.nlu_classifier(.scan.ocr.raw).entities, .name == \"urgency\")\n    )\n     and any(file.explode(.),\n        3 of (\n            any(.scan.strings.strings, strings.icontains(., \"review\")),\n            any(.scan.strings.strings, strings.icontains(., \"release\")),\n            any(.scan.strings.strings, strings.icontains(., \"quarantine\")),\n            any(ml.logo_detect(..).brands, .name in~ (\"Microsoft\", \"Office365\"))\n        )\n    )\n)\nand sender.email.domain.root_domain not in (\n    \"bing.com\",\n    \"microsoft.com\",\n    \"microsoftonline.com\",\n    \"microsoftsupport.com\",\n    \"microsoft365.com\",\n    \"office.com\",\n    \"onedrive.com\",\n    \"sharepointonline.com\",\n    \"yammer.com\",\n)\n"
tags:
  - "Brand impersonation"
  - "Suspicious content"
  - "Natural Language Understanding"
testing_pr: 593
testing_sha: 4424b9e9fcea4832b58504a30c9e3ac7165f7135
