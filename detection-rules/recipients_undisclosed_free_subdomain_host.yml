name: "Suspicious Link: Free Subdomain host with undisclosed recipients"
description: |
  Detects messages with undisclosed recipients, containing links to free subdomain hosts
type: "rule"
severity: "medium"
source: "type.inbound\n\nand any(body.links, \n    .href_url.domain.root_domain in $free_subdomain_hosts\n    and .href_url.domain.subdomain is not null\n    and .href_url.domain.subdomain != \"www\"\n)\nand (\n    length(recipients.to) == 0\n    or all(recipients.to, .display_name == \"Undisclosed recipients\")\n)\nand length(recipients.cc) == 0\nand length(recipients.bcc) == 0\n"
tags:
  - "Suspicious link"
  - "Suspicious headers"
testing_pr: 502
testing_sha: 9b97eb5206350bb2e55d7478bddb7bc82ef60200
