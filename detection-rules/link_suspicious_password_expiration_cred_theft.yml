name: "Link: Suspicious Password expiration credential theft"
description: |
  This rule detects suspicious emails with a moderate number of links (between 1 and 10) that reference password expiration in the body. The rule also considers links that are null routed
  or have a very short body with links to free subdomain hosts, indicating potentially suspicious activity.
type: "rule"
severity: "medium"
source: "type.inbound\nand 0 < length(body.links) < 10 \nand strings.ilike(body.html.display_text, \"*expir*\")\nand strings.ilike(body.html.display_text, \"*password*\")\nand any(ml.nlu_classifier(body.html.display_text).intents, .name == \"cred_theft\")\nand \n    (\n        any(body.links, .display_url.url is not null\n        and .display_url.url != .href_url.url\n        and .href_url.url == \"#\"\n    or\n        length(body.html.inner_text) < 300\n        and .href_url.domain.root_domain in $free_subdomain_hosts\n        and .href_url.domain.subdomain is not null\n        and .href_url.domain.subdomain != \"www\")\n    )\n"
tags:
  - "Credential phishing"
  - "Suspicious Link"
  - "Natural Language Understanding"
testing_pr: 601
testing_sha: dfd8af2b0eb9c70c3bafa2cfdd20b2af940ec331
