name: "Body: Microsoft logo and Bing open redirect"
description: |
  Email contains a Microsoft logo and use of the Bing open redirect. This has been exploited in the wild to impersonate Microsoft.
type: "rule"
severity: "high"
source: |
  type.inbound

  // Microsoft logo
  and (
      any(attachments,
          .file_type in ('png', 'jpeg', 'jpg', 'bmp')
          and any(ml.logo_detect(.).brands, .name in ("Microsoft", "Office365", "Outlook"))
      )
      or any(ml.logo_detect(beta.message_screenshot()).brands, .name in ("Microsoft", "Office365", "Outlook"))
  )

  // Bing redirect
  and any(body.links, .href_url.domain.root_domain == 'bing.com' and .href_url.path =~ '/ck/a')

  and sender.email.domain.root_domain not in $org_domains

  and sender.email.domain.root_domain not in (
      "bing.com",
      "microsoft.com",
      "microsoftonline.com",
      "microsoftsupport.com",
      "microsoft365.com",
      "office.com",
      "onedrive.com",
      "sharepointonline.com",
      "yammer.com",
  )
tags:
  - "Suspicious content"
  - "Brand impersonation"
  - "Suspicious link"
testing_pr: 589
testing_sha: dce13a0b23f90bb144f98d71b5f80557b5bb45ba
