name: "Attachment: HTML file with excessive padding and suspicious patterns"
description: |
  Attached HTML file contains excessive line breaks and suspicious Javascript patterns.
type: "rule"
severity: "high"
source: "type.inbound \nand any(attachments, \n    (\n        .content_type == \"text/html\"\n        or .file_extension in~ (\"html\", \"htm\", \"shtml\", \"dhtml\")\n        or .file_type == \"html\"\n    )\n    // excessive line breaks\n    and regex.icontains(.raw, \"^(DQoNCg0K){150,}\")\n    and any(file.explode(.), \n        any(.flavors.yara, . == \"javascript_file\")\n        // common indicator of HTML smuggling\n        and length(filter(.scan.javascript.identifiers, strings.ilike(., \"_0x*\"))) > 150\n    )\n)\n"
tags:
  - "HTML smuggling"
  - "Suspicious attachment"
testing_pr: 522
testing_sha: 4465d552b71a1d34cf1135034ea71ff0397d385a
