name: "Suspicious sender name and content"
description: |
  Sender display name contains unusual characters, and message content flags NLU.
type: "rule"
severity: "medium"
source: "type.inbound\nand regex.contains(sender.display_name, '(=?UTF-8?|[%!#*/\\\\;])')\nand (\n    any(ml.nlu_classifier(\n            coalesce(body.html.display_text, body.plain.raw)).intents, .name != \"benign\")\n    or any(ml.nlu_classifier(\n            coalesce(body.html.display_text, body.plain.raw)).entities, .name == \"financial\")\n    or any(ml.nlu_classifier(\n            coalesce(body.html.display_text, body.plain.raw)).entities, .name == \"urgency\")\n    or any(ml.nlu_classifier(\n            coalesce(body.html.display_text, body.plain.raw)).entities, .name == \"request\")\n    or any(attachments, \n        any(file.explode(.), \n            any(ml.nlu_classifier(.scan.ocr.raw).intents, .name != \"benign\")\n            or any(ml.nlu_classifier(.scan.ocr.raw).entities, .name == \"financial\")\n            or any(ml.nlu_classifier(.scan.ocr.raw).entities, .name == \"urgency\")\n            or any(ml.nlu_classifier(.scan.ocr.raw).entities, .name == \"request\")\n        )\n    )\n    or any(attachments,\n      .file_type in ('png', 'jpeg', 'jpg', 'bmp', 'pdf')\n      and any(beta.logo_detect(.).brands, .name is not null)\n    )\n)\n"
tags:
  - "Suspicious sender"
  - "Suspicious content"
  - "Natural Language Understanding"
testing_pr: 477
testing_sha: fc61f68d46fef19967653c9d14ed95ebade36ec0
