name: "Attachment: RTF file linking to free subdomain host"
description: "This rule detects RTF attachments directly attached or within an archive, containing an external link to a free_subdomain_host that is not an image."
type: "rule"
severity: "medium"
source: |
  type.inbound
  and any(attachments,
          (
            .file_extension in~ $file_extensions_common_archives
            or .file_type == "rtf"
          )
          and any(file.explode(.),
                  .flavors.mime == 'text/rtf'
                  and any(.scan.url.urls,
                          .domain.valid
                          and .domain.root_domain in $free_subdomain_hosts
                          and .domain.subdomain is not null
                          and not (
                            strings.ends_with(.url, "jpeg")
                            or strings.ends_with(.url, "png")
                          )
                          and .domain.subdomain != "www"
                  ),
          )
  )
  and not profile.by_sender().solicited
  and not profile.by_sender().any_false_positives
attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "Evasion"
detection_methods:
  - "Archive analysis"
  - "File analysis"
  - "Sender analysis"
  - "URL analysis"
id: "c848f9aa-6e2e-55ea-857e-9d040b22544f"
testing_pr: 1792
testing_sha: 008f4db40e922a0259680e17c33f9bf5e72801b1
